\! gs_ktool -d all
DELETE ALL

\! gs_ktool -g
GENERATE
1
DROP CLIENT MASTER KEY IF EXISTS CMK1 CASCADE;
NOTICE:  client master key "cmk1" does not exist
DROP USER IF EXISTS ce_user1;
NOTICE:  role "ce_user1" does not exist, skipping
CREATE USER ce_user1 PASSWORD 'gauss@123';
SET SESSION AUTHORIZATION ce_user1 PASSWORD 'gauss@123';
CREATE CLIENT MASTER KEY CMK1 WITH ( KEY_STORE = gs_ktool , KEY_PATH = "gs_ktool/1" , ALGORITHM = AES_256_CBC);
CREATE COLUMN ENCRYPTION KEY CEK1 WITH VALUES (CLIENT_MASTER_KEY = CMK1, ALGORITHM = AEAD_AES_256_CBC_HMAC_SHA256);
CREATE TABLE t_alteruser (c1 int, c2 text ENCRYPTED WITH (COLUMN_ENCRYPTION_KEY = CEK1, ENCRYPTION_TYPE = DETERMINISTIC));
INSERT INTO t_alteruser VALUES (1,'1'), (2,'2'), (3,'3'), (4,'4'), (5,'5');
RESET SESSION AUTHORIZATION;
ALTER USER ce_user1 PASSWORD 'gauss@1234' EXPIRED;
ALTER USER ce_user1 identified by 'gauss@1235' replace 'gauss@1234';
--?.*
 c1 | c2 
----+----
  1 | 1
  2 | 2
  3 | 3
  4 | 4
  5 | 5
(5 rows)

SET SESSION AUTHORIZATION ce_user1 PASSWORD 'gauss@1235';
DROP TABLE t_alteruser;
DROP COLUMN ENCRYPTION KEY CEK1;
DROP CLIENT MASTER KEY CMK1;
RESET SESSION AUTHORIZATION;
DROP USER IF EXISTS ce_user1;
\! gs_ktool -d all
DELETE ALL
 1
