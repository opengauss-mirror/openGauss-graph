--prepare
DROP SCHEMA subpartition_select CASCADE;
ERROR:  schema "subpartition_select" does not exist
CREATE SCHEMA subpartition_select;
SET CURRENT_SCHEMA TO subpartition_select;
--select
CREATE TABLE t1
(
	c1 int,
	c2 int
);
insert into t1 values(generate_series(201901,201910), generate_series(1,10));
CREATE TABLE range_list
(
    month_code VARCHAR2 ( 30 ) NOT NULL ,
    dept_code  VARCHAR2 ( 30 ) NOT NULL ,
    user_no    VARCHAR2 ( 30 ) NOT NULL ,
    sales_amt  int
)
PARTITION BY RANGE (month_code) SUBPARTITION BY LIST (dept_code)
(
  PARTITION p_201901 VALUES LESS THAN( '201903' )
  (
    SUBPARTITION p_201901_a values ('1'),
    SUBPARTITION p_201901_b values ('2')
  ),
  PARTITION p_201902 VALUES LESS THAN( '201910' )
  (
    SUBPARTITION p_201902_a values ('1'),
    SUBPARTITION p_201902_b values ('2')
  )
);
insert into range_list values('201902', '1', '1', 1);
insert into range_list values('201902', '2', '1', 1);
insert into range_list values('201902', '1', '1', 1);
insert into range_list values('201902', '3', '1', 1);
ERROR:  inserted partition key does not map to any table partition
insert into range_list values('201903', '2', '1', 1);
insert into range_list values('201903', '1', '1', 1);
insert into range_list values('201903', '2', '1', 1);
insert into range_list values('201903', '3', '1', 1);
ERROR:  inserted partition key does not map to any table partition
select * from range_list order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(6 rows)

select * from range_list where user_no is not null order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(6 rows)

select * from range_list where user_no is not null and dept_code = user_no order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
(3 rows)

select * from range_list where user_no is not null and dept_code in ('2') order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(3 rows)

select * from range_list where user_no is not null and dept_code  <> '2' order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
(3 rows)

select * from range_list partition (p_201901) order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1
(3 rows)

select * from range_list partition (p_201902) order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(3 rows)

select * from range_list where user_no is not null and dept_code  <> '2' UNION ALL select * from range_list partition (p_201902) order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(6 rows)

select * from range_list where user_no is not null and dept_code  <> '2' UNION ALL select * from range_list partition (p_201902) where dept_code in ('2') order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(5 rows)

CREATE TABLE range_hash
(
    month_code VARCHAR2 ( 30 ) NOT NULL ,
    dept_code  VARCHAR2 ( 30 ) NOT NULL ,
    user_no    VARCHAR2 ( 30 ) NOT NULL ,
    sales_amt  int
)
PARTITION BY RANGE (month_code) SUBPARTITION BY HASH (dept_code)
(
  PARTITION p_201901 VALUES LESS THAN( '201903' )
  (
    SUBPARTITION p_201901_a,
    SUBPARTITION p_201901_b
  ),
  PARTITION p_201902 VALUES LESS THAN( '201904' )
  (
    SUBPARTITION p_201902_a,
    SUBPARTITION p_201902_b
  )
);
insert into range_hash values('201902', '1', '1', 1);
insert into range_hash values('201902', '2', '1', 1);
insert into range_hash values('201902', '1', '1', 1);
insert into range_hash values('201903', '2', '1', 1);
insert into range_hash values('201903', '1', '1', 1);
insert into range_hash values('201903', '2', '1', 1);
select * from range_hash order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(6 rows)

select * from range_hash where user_no is not null order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(6 rows)

select * from range_hash where user_no is not null and dept_code = user_no order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
(3 rows)

select * from range_hash where user_no is not null and dept_code in ('2') order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(3 rows)

select * from range_hash where user_no is not null and dept_code  <> '2' order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
(3 rows)

select * from range_hash partition (p_201901) order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1
(3 rows)

select * from range_hash partition (p_201902) order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(3 rows)

select * from range_hash where user_no is not null and dept_code  <> '2' UNION ALL select * from range_hash partition (p_201902) order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(6 rows)

select * from range_hash where user_no is not null and dept_code  <> '2' UNION ALL select * from range_hash partition (p_201902) where dept_code in ('2') order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(5 rows)

explain (costs off, verbose on) select * from range_hash where ctid='(0,1)' order by 1, 2, 3, 4;
                                            QUERY PLAN                                             
---------------------------------------------------------------------------------------------------
 Sort
   Output: month_code, dept_code, user_no, sales_amt
   Sort Key: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
   ->  Partition Iterator
         Output: month_code, dept_code, user_no, sales_amt
         Iterations: 2, Sub Iterations: 4
         ->  Partitioned Tid Scan on subpartition_select.range_hash
               Output: month_code, dept_code, user_no, sales_amt
               TID Cond: (range_hash.ctid = '(0,1)'::tid)
               Selected Partitions:  1..2
               Selected Subpartitions:  ALL
(11 rows)

explain (costs off, verbose on) select * from range_hash where user_no is not null and dept_code = user_no order by 1, 2, 3, 4;
                                    QUERY PLAN                                     
-----------------------------------------------------------------------------------
 Sort
   Output: month_code, dept_code, user_no, sales_amt
   Sort Key: range_hash.month_code, range_hash.dept_code, range_hash.sales_amt
   ->  Partition Iterator
         Output: month_code, dept_code, user_no, sales_amt
         Iterations: 2, Sub Iterations: 4
         ->  Partitioned Seq Scan on subpartition_select.range_hash
               Output: month_code, dept_code, user_no, sales_amt
               Filter: ((range_hash.dept_code)::text = (range_hash.user_no)::text)
               Selected Partitions:  1..2
               Selected Subpartitions:  ALL
(11 rows)

explain (costs off, verbose on) select * from range_hash partition (p_201901) order by 1, 2, 3, 4;
                                            QUERY PLAN                                             
---------------------------------------------------------------------------------------------------
 Sort
   Output: month_code, dept_code, user_no, sales_amt
   Sort Key: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
   ->  Partition Iterator
         Output: month_code, dept_code, user_no, sales_amt
         Iterations: 1, Sub Iterations: 2
         ->  Partitioned Seq Scan on subpartition_select.range_hash
               Output: month_code, dept_code, user_no, sales_amt
               Selected Partitions:  1
               Selected Subpartitions:  ALL
(10 rows)

explain (costs off, verbose on) select * from range_hash where user_no is not null and dept_code  <> '2' UNION ALL select * from range_hash partition (p_201902) where dept_code in ('2') order by 1, 2, 3, 4;
                                                                                               QUERY PLAN                                                                                                
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Output: subpartition_select.range_hash.month_code, subpartition_select.range_hash.dept_code, subpartition_select.range_hash.user_no, subpartition_select.range_hash.sales_amt
   Sort Key: subpartition_select.range_hash.month_code, subpartition_select.range_hash.dept_code, subpartition_select.range_hash.user_no, subpartition_select.range_hash.sales_amt
   ->  Result
         Output: subpartition_select.range_hash.month_code, subpartition_select.range_hash.dept_code, subpartition_select.range_hash.user_no, subpartition_select.range_hash.sales_amt
         ->  Append
               ->  Partition Iterator
                     Output: subpartition_select.range_hash.month_code, subpartition_select.range_hash.dept_code, subpartition_select.range_hash.user_no, subpartition_select.range_hash.sales_amt
                     Iterations: 2, Sub Iterations: 4
                     ->  Partitioned Seq Scan on subpartition_select.range_hash
                           Output: subpartition_select.range_hash.month_code, subpartition_select.range_hash.dept_code, subpartition_select.range_hash.user_no, subpartition_select.range_hash.sales_amt
                           Filter: ((subpartition_select.range_hash.dept_code)::text <> '2'::text)
                           Selected Partitions:  1..2
                           Selected Subpartitions:  ALL
               ->  Partition Iterator
                     Output: subpartition_select.range_hash.month_code, subpartition_select.range_hash.dept_code, subpartition_select.range_hash.user_no, subpartition_select.range_hash.sales_amt
                     Iterations: 1, Sub Iterations: 2
                     ->  Partitioned Seq Scan on subpartition_select.range_hash
                           Output: subpartition_select.range_hash.month_code, subpartition_select.range_hash.dept_code, subpartition_select.range_hash.user_no, subpartition_select.range_hash.sales_amt
                           Filter: ((subpartition_select.range_hash.dept_code)::text = '2'::text)
                           Selected Partitions:  2
                           Selected Subpartitions:  ALL
(22 rows)

CREATE TABLE range_range
(
    month_code VARCHAR2 ( 30 ) NOT NULL ,
    dept_code  VARCHAR2 ( 30 ) NOT NULL ,
    user_no    VARCHAR2 ( 30 ) NOT NULL ,
    sales_amt  int
)
PARTITION BY RANGE (month_code) SUBPARTITION BY RANGE (dept_code)
(
  PARTITION p_201901 VALUES LESS THAN( '201903' )
  (
    SUBPARTITION p_201901_a VALUES LESS THAN( '2' ),
    SUBPARTITION p_201901_b VALUES LESS THAN( '3' )
  ),
  PARTITION p_201902 VALUES LESS THAN( '201904' )
  (
    SUBPARTITION p_201902_a VALUES LESS THAN( '2' ),
    SUBPARTITION p_201902_b VALUES LESS THAN( '3' )
  )
);
insert into range_range values('201902', '1', '1', 1);
insert into range_range values('201902', '2', '1', 1);
insert into range_range values('201902', '1', '1', 1);
insert into range_range values('201903', '2', '1', 1);
insert into range_range values('201903', '1', '1', 1);
insert into range_range values('201903', '2', '1', 1);
select * from range_range order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(6 rows)

select * from range_range where user_no is not null order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(6 rows)

select * from range_range where user_no is not null and dept_code = user_no order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
(3 rows)

select * from range_range where user_no is not null and dept_code in ('2') order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(3 rows)

select * from range_range where user_no is not null and dept_code  <> '2' order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
(3 rows)

select * from range_range partition (p_201901) order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1
(3 rows)

select * from range_range partition (p_201902) order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(3 rows)

select * from range_range where user_no is not null and dept_code  <> '2' UNION ALL select * from range_range partition (p_201902) order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(6 rows)

select * from range_range where user_no is not null and dept_code  <> '2' UNION ALL select * from range_range partition (p_201902) where dept_code in ('2') order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(5 rows)

explain (costs off, verbose on) select * from range_range where user_no is not null and dept_code in ('2') order by 1, 2, 3, 4;
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Sort
   Output: month_code, dept_code, user_no, sales_amt
   Sort Key: range_range.month_code, range_range.user_no, range_range.sales_amt
   ->  Partition Iterator
         Output: month_code, dept_code, user_no, sales_amt
         Iterations: 2, Sub Iterations: 2
         ->  Partitioned Seq Scan on subpartition_select.range_range
               Output: month_code, dept_code, user_no, sales_amt
               Filter: ((range_range.dept_code)::text = '2'::text)
               Selected Partitions:  1..2
               Selected Subpartitions:  1:1, 2:1
(11 rows)

explain (costs off, verbose on) select * from range_range partition (p_201901) order by 1, 2, 3, 4;
                                              QUERY PLAN                                               
-------------------------------------------------------------------------------------------------------
 Sort
   Output: month_code, dept_code, user_no, sales_amt
   Sort Key: range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
   ->  Partition Iterator
         Output: month_code, dept_code, user_no, sales_amt
         Iterations: 1, Sub Iterations: 2
         ->  Partitioned Seq Scan on subpartition_select.range_range
               Output: month_code, dept_code, user_no, sales_amt
               Selected Partitions:  1
               Selected Subpartitions:  ALL
(10 rows)

--view
create view view_temp  as select * from range_list;
select * from view_temp;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1
(6 rows)

--error
select * from view_temp partition (p_201901);
ERROR:  relation "view_temp" is not partitioned table
DETAIL:  N/A.
select * from view_temp partition (p_201902);
ERROR:  relation "view_temp" is not partitioned table
DETAIL:  N/A.
drop view view_temp;
with tmp1 as (select * from range_list ) select * from tmp1 order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1
(6 rows)

with tmp1 as (select * from range_list partition (p_201901)) select * from tmp1 order by 1, 2, 3, 4;
 month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------
 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1
(3 rows)

--join normal table 
select * from range_list left join t1 on range_list.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(6 rows)

select * from range_list left join t1 on range_list.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

select * from range_list right join t1 on range_list.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
            |           |         |           | 201901 |  1
            |           |         |           | 201904 |  4
            |           |         |           | 201905 |  5
            |           |         |           | 201906 |  6
            |           |         |           | 201907 |  7
            |           |         |           | 201908 |  8
            |           |         |           | 201909 |  9
            |           |         |           | 201910 | 10
(14 rows)

select * from range_list right join t1 on range_list.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

select * from range_list full join t1 on range_list.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
            |           |         |           | 201901 |  1
            |           |         |           | 201904 |  4
            |           |         |           | 201905 |  5
            |           |         |           | 201906 |  6
            |           |         |           | 201907 |  7
            |           |         |           | 201908 |  8
            |           |         |           | 201909 |  9
            |           |         |           | 201910 | 10
(14 rows)

select * from range_list full join t1 on range_list.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

select * from range_list inner join t1 on range_list.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(6 rows)

select * from range_list inner join t1 on range_list.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

explain (costs off, verbose on) select * from range_list inner join t1 on range_list.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
                                                       QUERY PLAN                                                        
-------------------------------------------------------------------------------------------------------------------------
 Sort
   Output: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt, t1.c1, t1.c2
   Sort Key: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt, t1.c1, t1.c2
   ->  Hash Join
         Output: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt, t1.c1, t1.c2
         Hash Cond: (t1.c1 = (range_list.month_code)::bigint)
         ->  Seq Scan on subpartition_select.t1
               Output: t1.c1, t1.c2
         ->  Hash
               Output: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt
               ->  Partition Iterator
                     Output: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt
                     Iterations: 2, Sub Iterations: 4
                     ->  Partitioned Seq Scan on subpartition_select.range_list
                           Output: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt
                           Filter: ((range_list.dept_code)::bigint = 2)
                           Selected Partitions:  1..2
                           Selected Subpartitions:  ALL
(18 rows)

select * from range_hash left join t1 on range_hash.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(6 rows)

select * from range_hash left join t1 on range_hash.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

select * from range_hash right join t1 on range_hash.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
            |           |         |           | 201901 |  1
            |           |         |           | 201904 |  4
            |           |         |           | 201905 |  5
            |           |         |           | 201906 |  6
            |           |         |           | 201907 |  7
            |           |         |           | 201908 |  8
            |           |         |           | 201909 |  9
            |           |         |           | 201910 | 10
(14 rows)

select * from range_hash right join t1 on range_hash.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

select * from range_hash full join t1 on range_hash.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
            |           |         |           | 201901 |  1
            |           |         |           | 201904 |  4
            |           |         |           | 201905 |  5
            |           |         |           | 201906 |  6
            |           |         |           | 201907 |  7
            |           |         |           | 201908 |  8
            |           |         |           | 201909 |  9
            |           |         |           | 201910 | 10
(14 rows)

select * from range_hash full join t1 on range_hash.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

select * from range_hash inner join t1 on range_hash.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(6 rows)

select * from range_hash inner join t1 on range_hash.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

explain (costs off, verbose on) select * from range_hash inner join t1 on range_hash.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
                                                       QUERY PLAN                                                        
-------------------------------------------------------------------------------------------------------------------------
 Sort
   Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt, t1.c1, t1.c2
   Sort Key: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt, t1.c1, t1.c2
   ->  Hash Join
         Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt, t1.c1, t1.c2
         Hash Cond: (t1.c1 = (range_hash.month_code)::bigint)
         ->  Seq Scan on subpartition_select.t1
               Output: t1.c1, t1.c2
         ->  Hash
               Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
               ->  Partition Iterator
                     Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
                     Iterations: 2, Sub Iterations: 4
                     ->  Partitioned Seq Scan on subpartition_select.range_hash
                           Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
                           Filter: ((range_hash.dept_code)::bigint = 2)
                           Selected Partitions:  1..2
                           Selected Subpartitions:  ALL
(18 rows)

select * from range_range left join t1 on range_range.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(6 rows)

select * from range_range left join t1 on range_range.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

select * from range_range right join t1 on range_range.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
            |           |         |           | 201901 |  1
            |           |         |           | 201904 |  4
            |           |         |           | 201905 |  5
            |           |         |           | 201906 |  6
            |           |         |           | 201907 |  7
            |           |         |           | 201908 |  8
            |           |         |           | 201909 |  9
            |           |         |           | 201910 | 10
(14 rows)

select * from range_range right join t1 on range_range.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

select * from range_range full join t1 on range_range.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
            |           |         |           | 201901 |  1
            |           |         |           | 201904 |  4
            |           |         |           | 201905 |  5
            |           |         |           | 201906 |  6
            |           |         |           | 201907 |  7
            |           |         |           | 201908 |  8
            |           |         |           | 201909 |  9
            |           |         |           | 201910 | 10
(14 rows)

select * from range_range full join t1 on range_range.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

select * from range_range inner join t1 on range_range.month_code = t1.c1 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 1         | 1       |         1 | 201902 |  2
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 1         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(6 rows)

select * from range_range inner join t1 on range_range.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
 month_code | dept_code | user_no | sales_amt |   c1   | c2 
------------+-----------+---------+-----------+--------+----
 201902     | 2         | 1       |         1 | 201902 |  2
 201903     | 2         | 1       |         1 | 201903 |  3
 201903     | 2         | 1       |         1 | 201903 |  3
(3 rows)

explain (costs off, verbose on) select * from range_range inner join t1 on range_range.month_code = t1.c1 where dept_code = 2 order by 1, 2, 3, 4, 5, 6;
                                                         QUERY PLAN                                                          
-----------------------------------------------------------------------------------------------------------------------------
 Sort
   Output: range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt, t1.c1, t1.c2
   Sort Key: range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt, t1.c1, t1.c2
   ->  Hash Join
         Output: range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt, t1.c1, t1.c2
         Hash Cond: (t1.c1 = (range_range.month_code)::bigint)
         ->  Seq Scan on subpartition_select.t1
               Output: t1.c1, t1.c2
         ->  Hash
               Output: range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
               ->  Partition Iterator
                     Output: range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
                     Iterations: 2, Sub Iterations: 4
                     ->  Partitioned Seq Scan on subpartition_select.range_range
                           Output: range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
                           Filter: ((range_range.dept_code)::bigint = 2)
                           Selected Partitions:  1..2
                           Selected Subpartitions:  ALL
(18 rows)

--join range_list and range_hash
select * from range_list left join range_hash on range_list.month_code = range_hash.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_list left join range_hash on range_list.month_code = range_hash.month_code where range_list.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

select * from range_list right join range_hash on range_list.month_code = range_hash.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_list right join range_hash on range_list.month_code = range_hash.month_code where range_list.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

select * from range_list full join range_hash on range_list.month_code = range_hash.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_list full join range_hash on range_list.month_code = range_hash.month_code where range_list.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

select * from range_list inner join range_hash on range_list.month_code = range_hash.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_list inner join range_hash on range_list.month_code = range_hash.month_code where range_list.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

explain (costs off, verbose on) select * from range_list inner join range_hash on range_list.month_code = range_hash.month_code where range_list.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
                                                                                          QUERY PLAN                                                                                          
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Output: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt, range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
   Sort Key: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
   ->  Hash Join
         Output: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt, range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
         Hash Cond: ((range_hash.month_code)::text = (range_list.month_code)::text)
         ->  Partition Iterator
               Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
               Iterations: 2, Sub Iterations: 4
               ->  Partitioned Seq Scan on subpartition_select.range_hash
                     Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
                     Selected Partitions:  1..2
                     Selected Subpartitions:  ALL
         ->  Hash
               Output: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt
               ->  Partition Iterator
                     Output: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt
                     Iterations: 2, Sub Iterations: 4
                     ->  Partitioned Seq Scan on subpartition_select.range_list
                           Output: range_list.month_code, range_list.dept_code, range_list.user_no, range_list.sales_amt
                           Filter: ((range_list.dept_code)::bigint = 2)
                           Selected Partitions:  1..2
                           Selected Subpartitions:  ALL
(23 rows)

--join range_hash and range_range
select * from range_hash left join range_range on range_hash.month_code = range_range.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_hash left join range_range on range_hash.month_code = range_range.month_code where range_hash.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

select * from range_hash right join range_range on range_hash.month_code = range_range.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_hash right join range_range on range_hash.month_code = range_range.month_code where range_hash.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

select * from range_hash full join range_range on range_hash.month_code = range_range.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_hash full join range_range on range_hash.month_code = range_range.month_code where range_hash.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

select * from range_hash inner join range_range on range_hash.month_code = range_range.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_hash inner join range_range on range_hash.month_code = range_range.month_code where range_hash.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

explain (costs off, verbose on) select * from range_hash inner join range_range on range_hash.month_code = range_range.month_code where range_hash.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
                                                                                            QUERY PLAN                                                                                            
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt, range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
   Sort Key: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt, range_range.dept_code, range_range.user_no, range_range.sales_amt
   ->  Hash Join
         Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt, range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
         Hash Cond: ((range_range.month_code)::text = (range_hash.month_code)::text)
         ->  Partition Iterator
               Output: range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
               Iterations: 2, Sub Iterations: 4
               ->  Partitioned Seq Scan on subpartition_select.range_range
                     Output: range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
                     Selected Partitions:  1..2
                     Selected Subpartitions:  ALL
         ->  Hash
               Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
               ->  Partition Iterator
                     Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
                     Iterations: 2, Sub Iterations: 4
                     ->  Partitioned Seq Scan on subpartition_select.range_hash
                           Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
                           Filter: ((range_hash.dept_code)::bigint = 2)
                           Selected Partitions:  1..2
                           Selected Subpartitions:  ALL
(23 rows)

--join range_hash and range_range
select * from range_hash left join range_range on range_hash.month_code = range_range.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_hash left join range_range on range_hash.month_code = range_range.month_code where range_hash.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

select * from range_hash right join range_range on range_hash.month_code = range_range.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_hash right join range_range on range_hash.month_code = range_range.month_code where range_hash.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

select * from range_hash full join range_range on range_hash.month_code = range_range.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_hash full join range_range on range_hash.month_code = range_range.month_code where range_hash.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

select * from range_hash inner join range_range on range_hash.month_code = range_range.month_code order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 1         | 1       |         1 | 201902     | 2         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 1         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(18 rows)

select * from range_hash inner join range_range on range_hash.month_code = range_range.month_code where range_hash.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
 month_code | dept_code | user_no | sales_amt | month_code | dept_code | user_no | sales_amt 
------------+-----------+---------+-----------+------------+-----------+---------+-----------
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 1         | 1       |         1
 201902     | 2         | 1       |         1 | 201902     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 1         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
 201903     | 2         | 1       |         1 | 201903     | 2         | 1       |         1
(9 rows)

explain (costs off, verbose on) select * from range_hash inner join range_range on range_hash.month_code = range_range.month_code where range_hash.dept_code = 2 order by 1, 2, 3, 4, 5, 6, 7, 8;
                                                                                            QUERY PLAN                                                                                            
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt, range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
   Sort Key: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt, range_range.dept_code, range_range.user_no, range_range.sales_amt
   ->  Hash Join
         Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt, range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
         Hash Cond: ((range_range.month_code)::text = (range_hash.month_code)::text)
         ->  Partition Iterator
               Output: range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
               Iterations: 2, Sub Iterations: 4
               ->  Partitioned Seq Scan on subpartition_select.range_range
                     Output: range_range.month_code, range_range.dept_code, range_range.user_no, range_range.sales_amt
                     Selected Partitions:  1..2
                     Selected Subpartitions:  ALL
         ->  Hash
               Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
               ->  Partition Iterator
                     Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
                     Iterations: 2, Sub Iterations: 4
                     ->  Partitioned Seq Scan on subpartition_select.range_hash
                           Output: range_hash.month_code, range_hash.dept_code, range_hash.user_no, range_hash.sales_amt
                           Filter: ((range_hash.dept_code)::bigint = 2)
                           Selected Partitions:  1..2
                           Selected Subpartitions:  ALL
(23 rows)

drop table list_range_02;
ERROR:  table "list_range_02" does not exist
CREATE   TABLE IF NOT EXISTS list_range_02
(
    col_1 int ,
    col_2 int, 
	col_3 VARCHAR2 ( 30 )  ,
    col_4  int
)
PARTITION BY list (col_1) SUBPARTITION BY range (col_2)
(
 PARTITION p_list_1 VALUES(-1,-2,-3,-4,-5,-6,-7,-8,-9,-10 )
  (
    SUBPARTITION p_range_1_1 VALUES LESS THAN( -10 ),
    SUBPARTITION p_range_1_2 VALUES LESS THAN( 0 ),
    SUBPARTITION p_range_1_3 VALUES LESS THAN( 10 ),
    SUBPARTITION p_range_1_4 VALUES LESS THAN( 20 ),
    SUBPARTITION p_range_1_5 VALUES LESS THAN( 50 )
  ),
  PARTITION p_list_2 VALUES(1,2,3,4,5,6,7,8,9,10 ),
  PARTITION p_list_3 VALUES(11,12,13,14,15,16,17,18,19,20)
  (
    SUBPARTITION p_range_3_1 VALUES LESS THAN( 15 ),
    SUBPARTITION p_range_3_2 VALUES LESS THAN( MAXVALUE )
  ),
    PARTITION p_list_4 VALUES(21,22,23,24,25,26,27,28,29,30)
  (
    SUBPARTITION p_range_4_1 VALUES LESS THAN( -10 ),
    SUBPARTITION p_range_4_2 VALUES LESS THAN( 0 ),
    SUBPARTITION p_range_4_3 VALUES LESS THAN( 10 ),
    SUBPARTITION p_range_4_4 VALUES LESS THAN( 20 ),
    SUBPARTITION p_range_4_5 VALUES LESS THAN( 50 )
  ),
   PARTITION p_list_5 VALUES(31,32,33,34,35,36,37,38,39,40)
  (
    SUBPARTITION p_range_5_1 VALUES LESS THAN( MAXVALUE )
  ),
   PARTITION p_list_6 VALUES(41,42,43,44,45,46,47,48,49,50)
   (
    SUBPARTITION p_range_6_1 VALUES LESS THAN( -10 ),
    SUBPARTITION p_range_6_2 VALUES LESS THAN( 0 ),
    SUBPARTITION p_range_6_3 VALUES LESS THAN( 10 ),
    SUBPARTITION p_range_6_4 VALUES LESS THAN( 20 ),
    SUBPARTITION p_range_6_5 VALUES LESS THAN( 50 )
   ),
   PARTITION p_list_7 VALUES(default)
) ENABLE ROW MOVEMENT;
create index index_01 on list_range_02(col_2) local ;
INSERT INTO list_range_02 VALUES (GENERATE_SERIES(0, 19),GENERATE_SERIES(0, 1000),GENERATE_SERIES(0, 99));
 explain (costs off, verbose on) select *  from list_range_02 where col_2 >500 and col_2 <8000 order by col_1;
                                           QUERY PLAN                                           
------------------------------------------------------------------------------------------------
 Sort
   Output: col_1, col_2, col_3, col_4
   Sort Key: list_range_02.col_1
   ->  Partition Iterator
         Output: col_1, col_2, col_3, col_4
         Iterations: 4, Sub Iterations: 4
         ->  Partitioned Bitmap Heap Scan on subpartition_select.list_range_02
               Output: col_1, col_2, col_3, col_4
               Recheck Cond: ((list_range_02.col_2 > 500) AND (list_range_02.col_2 < 8000))
               Selected Partitions:  1,3,5..6
               Selected Subpartitions:  1:1, 3:1, 5:1, 6:1
               ->  Partitioned Bitmap Index Scan on index_01
                     Index Cond: ((list_range_02.col_2 > 500) AND (list_range_02.col_2 < 8000))
                     Selected Partitions:  1,3,5..6
                     Selected Subpartitions:  1:1, 3:1, 5:1, 6:1
(15 rows)

drop index index_01;
drop table list_range_02;
create table pjade(jid int,jn int,name varchar2)partition by range(jid) subpartition by range(jn)
(
  partition hrp1 values less than(16)(
    subpartition hrp1_1 values less than(16),
    subpartition hrp1_2 values less than(maxvalue)),
  partition hrp2 values less than(maxvalue)(
    subpartition hrp3_1 values less than(16),
    subpartition hrp3_3 values less than(maxvalue))
);
create table cjade(jid int,jn int,name varchar2);
insert into pjade values(6,8,'tom'),(8,18,'jerry'),(16,8,'jade'),(18,20,'jack');
insert into cjade values(6,8,'tom'),(8,18,'jerry'),(16,8,'jade'),(18,20,'jack');
select * from pjade subpartition(hrp1_1) union select * from cjade order by 1,2,3;
 jid | jn | name  
-----+----+-------
   6 |  8 | tom
   8 | 18 | jerry
  16 |  8 | jade
  18 | 20 | jack
(4 rows)

select * from pjade subpartition(hrp1_1) p union select * from cjade order by 1,2,3;
 jid | jn | name  
-----+----+-------
   6 |  8 | tom
   8 | 18 | jerry
  16 |  8 | jade
  18 | 20 | jack
(4 rows)

select * from pjade subpartition(hrp1_1) union select * from cjade order by 1,2,3;
 jid | jn | name  
-----+----+-------
   6 |  8 | tom
   8 | 18 | jerry
  16 |  8 | jade
  18 | 20 | jack
(4 rows)

select * from pjade subpartition(hrp1_1) p union select * from cjade order by 1,2,3;
 jid | jn | name  
-----+----+-------
   6 |  8 | tom
   8 | 18 | jerry
  16 |  8 | jade
  18 | 20 | jack
(4 rows)

drop table pjade;
drop table cjade;
DROP SCHEMA subpartition_select CASCADE;
NOTICE:  drop cascades to 4 other objects
DETAIL:  drop cascades to table t1
drop cascades to table range_list
drop cascades to table range_hash
drop cascades to table range_range
