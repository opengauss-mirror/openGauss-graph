-- test for regular table
set current_schema=vsonic_agg_engine;
set enable_sonic_hashjoin=on;
set enable_sonic_hashagg=on;
set enable_sort = off;
set time zone prc;
set time zone prc;
set datestyle to iso;
--groupby columns with different types
explain (costs off)
select
	min(col_a2)
from VECTOR_AGG_TABLE_01 
where col_a1>1 and col_a2>5 and col_a3%100<5 and col_a4%100<5 
group by 
	col_a1,col_a3,col_a4,
	col_smallint,col_integer,col_bigint,col_oid,
	col_real,col_numeric,col_numeric2,col_numeric3,
	col_numeric4,col_float,col_float2,col_t1,
	col_t2,col_t3,col_double_precision,
	col_decimal,col_char,col_char2,col_char3,
	col_varchar,col_varchar2,col_varchar3,col_text,
	col_time_without_time_zone,col_time_with_time_zone,col_timestamp_without_timezone,col_timestamp_with_timezone,
	col_smalldatetime,col_date,col_inet,col_inet
	order by 1
limit 10;
                                                                                                                                                                                                                                                     QUERY PLAN                                                                                                                                                                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Row Adapter
   ->  Vector Limit
         ->  Vector Streaming (type: GATHER)
               Merge Sort Key: (min(col_a2))
               Node/s: All datanodes
               ->  Vector Limit
                     ->  Vector Sort
                           Sort Key: (min(col_a2))
                           ->  Vector Sonic Hash Aggregate
                                 Group By Key: col_a1, col_a3, col_a4, col_smallint, col_integer, col_bigint, col_oid, col_real, col_numeric, col_numeric2, col_numeric3, col_numeric4, col_float, col_float2, col_t1, col_t2, col_t3, col_double_precision, col_decimal, col_char, col_char2, col_char3, col_varchar, col_varchar2, col_varchar3, col_text, col_time_without_time_zone, col_time_with_time_zone, col_timestamp_without_timezone, col_timestamp_with_timezone, col_smalldatetime, col_date, col_inet
                                 ->  CStore Scan on vector_agg_table_01
                                       Filter: ((col_a2 > 5) AND ((col_a1)::bigint > 1) AND ((col_a3 % 100) < 5) AND ((col_a4 % 100::bigint) < 5))
(12 rows)

select
	min(col_a2)
from VECTOR_AGG_TABLE_01 
where col_a1>1 and col_a2>5 and col_a3%100<5 and col_a4%100<5 
group by 
	col_a1,col_a3,col_a4,
	col_smallint,col_integer,col_bigint,col_oid,
	col_real,col_numeric,col_numeric2,col_numeric3,
	col_numeric4,col_float,col_float2,col_t1,
	col_t2,col_t3,col_double_precision,
	col_decimal,col_char,col_char2,col_char3,
	col_varchar,col_varchar2,col_varchar3,col_text,
	col_time_without_time_zone,col_time_with_time_zone,col_timestamp_without_timezone,col_timestamp_with_timezone,
	col_smalldatetime,col_date
	order by 1
limit 10;
 min 
-----
   6
   6
   6
   6
   6
   9
   9
   9
   9
   9
(10 rows)

--test for int4, int8 , numeric operator
explain (costs off) 
select 
	col_a3+3,col_a3-3,col_a3*2,col_a3/2,
	col_a4+col_bigint,col_a4-col_bigint,col_a4*col_bigint,col_a4/col_bigint,
	col_numeric+col_numeric4,col_numeric-col_numeric4,col_numeric*col_numeric4,col_numeric/col_numeric4
from VECTOR_AGG_TABLE_01  where col_a1>1 and col_a2>5 and col_a3%100<5 and col_a4%100<5
group by 
	col_a3, col_a4,col_numeric,col_numeric4,col_bigint order by 1 limit 10;
                                                                    QUERY PLAN                                                                     
---------------------------------------------------------------------------------------------------------------------------------------------------
 Row Adapter
   ->  Vector Limit
         ->  Vector Streaming (type: GATHER)
               Merge Sort Key: ((col_a3 + 3))
               Node/s: All datanodes
               ->  Vector Limit
                     ->  Vector Sort
                           Sort Key: ((col_a3 + 3))
                           ->  Vector Sonic Hash Aggregate
                                 Group By Key: col_a3, col_a4, col_numeric, col_numeric4, col_bigint
                                 ->  CStore Scan on vector_agg_table_01
                                       Filter: ((col_a2 > 5) AND ((col_a1)::bigint > 1) AND ((col_a3 % 100) < 5) AND ((col_a4 % 100::bigint) < 5))
(12 rows)

	
select 
	col_a3+3,col_a3-3,col_a3*2,col_a3/2,
	col_a4+col_bigint,col_a4-col_bigint,col_a4*col_bigint,col_a4/col_bigint,
	col_numeric+col_numeric4,col_numeric-col_numeric4,col_numeric*col_numeric4,col_numeric/col_numeric4
from VECTOR_AGG_TABLE_01  where col_a1>1 and col_a2>5 and col_a3%100<5 and col_a4%100<5
group by 
	col_a3, col_a4,col_numeric,col_numeric4,col_bigint order by 1 limit 10;
 ?column? | ?column? | ?column? | ?column? | ?column? | ?column? | ?column?  |     ?column?      |    ?column?     |    ?column?     |     ?column?     |      ?column?       
----------+----------+----------+----------+----------+----------+-----------+-------------------+-----------------+-----------------+------------------+---------------------
  -123594 |  -123600 |  -247194 | -61798.5 |   123606 |  -108600 | 871120809 | .0646236531355779 | 31.942844266520 | 27.542844266520 | 65.4342573863440 | 13.5194746666000000
  -123527 |  -123533 |  -247060 |   -61765 |   123271 |  -108667 | 846805638 | .0629651027429744 | 31.875844266520 | 27.475844266520 | 65.2868573863440 | 13.4890201211454545
  -123494 |  -123500 |  -246994 | -61748.5 |   123106 |  -108700 | 834849309 | .0621467951649224 | 31.842844266520 | 27.442844266520 | 65.2142573863440 | 13.4740201211454545
  -123427 |  -123433 |  -246860 |   -61715 |   122771 |  -108767 | 810614538 | .0604825125897261 | 31.775844266520 | 27.375844266520 | 65.0668573863440 | 13.4435655756909091
  -123394 |  -123400 |  -246794 | -61698.5 |   122606 |  -108800 | 798697809 | .0596613743809581 | 31.742844266520 | 27.342844266520 | 64.9942573863440 | 13.4285655756909091
  -123327 |  -123333 |  -246660 |   -61665 |   122271 |  -108867 | 774543438 | .0579913298548919 | 31.675844266520 | 27.275844266520 | 64.8468573863440 | 13.3981110302363636
  -123294 |  -123300 |  -246594 | -61648.5 |   122106 |  -108900 | 762666309 | .0571673463026934 | 31.642844266520 | 27.242844266520 | 64.7742573863440 | 13.3831110302363636
  -123227 |  -123233 |  -246460 |   -61615 |   121771 |  -108967 | 738592338 | .0554915098509998 | 31.575844266520 | 27.175844266520 | 64.6268573863440 | 13.3526564847818182
  -123194 |  -123200 |  -246394 | -61598.5 |   121606 |  -109000 | 726754809 | .0546646661405167 | 31.542844266520 | 27.142844266520 | 64.5542573863440 | 13.3376564847818182
  -123127 |  -123133 |  -246260 |   -61565 |   121271 |  -109067 | 702761238 | .0529830075801648 | 31.475844266520 | 27.075844266520 | 64.4068573863440 | 13.3072019393272727
(10 rows)

--int2,int4,int8 and numeric
select
	col_float2,min(col_a2),avg(col_a2),sum(col_a2),
	sum(abs(col_a3)),max(col_a3),avg(col_a3),count(col_a3),
	max(col_numeric),avg(col_numeric),count(col_numeric),
	sum(col_numeric3),avg(abs(col_numeric3)),
	max(col_a4),avg(col_a4),sum(col_a4)
from VECTOR_AGG_TABLE_01 
where col_a1>1 and col_a2>5 and col_a3%100<5 and col_a4%100<5
group by 
	col_float2
	order by 5 limit 10;
      col_float2      | min |        avg         | sum | sum  |  max  |          avg           | count |        max        |          avg          | count |   sum   |          avg          |  max  |          avg           |  sum  
----------------------+-----+--------------------+-----+------+-------+------------------------+-------+-------------------+-----------------------+-------+---------+-----------------------+-------+------------------------+-------
 6.10324198119132e+16 |   9 | 9.0000000000000000 |  18 | 5228 | -2589 | -2614.0000000000000000 |     2 |  830.945697799500 |  823.4456977995000000 |     2 | 5228.00 | 2614.0000000000000000 | 10901 | 10801.0000000000000000 | 21602
 6.10324198119133e+16 |   9 | 9.0000000000000000 |  18 | 5428 | -2689 | -2714.0000000000000000 |     2 |  860.945697799500 |  853.4456977995000000 |     2 | 5428.00 | 2714.0000000000000000 | 11301 | 11201.0000000000000000 | 22402
 6.10324198119134e+16 |   9 | 9.0000000000000000 |  18 | 5628 | -2789 | -2814.0000000000000000 |     2 |  890.945697799500 |  883.4456977995000000 |     2 | 5628.00 | 2814.0000000000000000 | 11701 | 11601.0000000000000000 | 23202
 6.10324198119135e+16 |   9 | 9.0000000000000000 |  18 | 5828 | -2889 | -2914.0000000000000000 |     2 |  920.945697799500 |  913.4456977995000000 |     2 | 5828.00 | 2914.0000000000000000 | 12101 | 12001.0000000000000000 | 24002
 6.10324198119166e+16 |   9 | 9.0000000000000000 |   9 | 5989 | -5989 | -5989.0000000000000000 |     1 | 1835.945697799500 | 1835.9456977995000000 |     1 | 5989.00 | 5989.0000000000000000 | 24301 |     24301.000000000000 | 24301
 6.10324198119136e+16 |   9 | 9.0000000000000000 |  18 | 6028 | -2989 | -3014.0000000000000000 |     2 |  950.945697799500 |  943.4456977995000000 |     2 | 6028.00 | 3014.0000000000000000 | 12501 | 12401.0000000000000000 | 24802
 6.10324198119137e+16 |   9 | 9.0000000000000000 |  18 | 6228 | -3089 | -3114.0000000000000000 |     2 |  980.945697799500 |  973.4456977995000000 |     2 | 6228.00 | 3114.0000000000000000 | 12901 | 12801.0000000000000000 | 25602
 6.10324198119138e+16 |   9 | 9.0000000000000000 |  18 | 6428 | -3189 | -3214.0000000000000000 |     2 | 1010.945697799500 | 1003.4456977995000000 |     2 | 6428.00 | 3214.0000000000000000 | 13301 | 13201.0000000000000000 | 26402
 6.10324198119139e+16 |   9 | 9.0000000000000000 |  18 | 6628 | -3289 | -3314.0000000000000000 |     2 | 1040.945697799500 | 1033.4456977995000000 |     2 | 6628.00 | 3314.0000000000000000 | 13701 | 13601.0000000000000000 | 27202
  6.1032419811914e+16 |   9 | 9.0000000000000000 |  18 | 6828 | -3389 | -3414.0000000000000000 |     2 | 1070.945697799500 | 1063.4456977995000000 |     2 | 6828.00 | 3414.0000000000000000 | 14101 | 14001.0000000000000000 | 28002
(10 rows)

	
--agg column is all null 
update VECTOR_AGG_TABLE_01 set col_a3 = null where col_a3 is not null;
--groupby column is all null 
update VECTOR_AGG_TABLE_01 set col_smallint = null where col_smallint is not null;
update VECTOR_AGG_TABLE_01 set col_char2 = null where col_char2 is not null;
--agg colum is random null 
update VECTOR_AGG_TABLE_01 set col_numeric = null where col_a4%7=4;
--groupby colum is random null 
update VECTOR_AGG_TABLE_01 set col_integer = null where col_bigint%11>4;
select
	min(col_a2),avg(col_a2),sum(col_a2),
	sum(col_a3),max(col_a3),avg(col_a3),count(col_a3),
	max(col_numeric),avg(col_numeric),count(col_numeric),
	sum(col_numeric3),avg(col_numeric3),
	max(col_a4),avg(col_a4),sum(col_a4)
from VECTOR_AGG_TABLE_01 
group by 
	col_a4,
	col_smallint
	order by 12 limit 10;
 min |           avg           | sum | sum | max | avg | count |        max        |          avg          | count |   sum    |          avg           |  max  |          avg           |  sum  
-----+-------------------------+-----+-----+-----+-----+-------+-------------------+-----------------------+-------+----------+------------------------+-------+------------------------+-------
  -1 | -1.00000000000000000000 |  -1 |     |     |     |     0 | -439.677184620415 | -439.6771846204150000 |     1 | -1001.00 | -1001.0000000000000000 | -1979 | -1979.0000000000000000 | -1979
   0 |  0.00000000000000000000 |   0 |     |     |     |     0 | -438.677184620415 | -438.6771846204150000 |     1 | -1000.00 | -1000.0000000000000000 | -1977 | -1977.0000000000000000 | -1977
  -9 |     -9.0000000000000000 |  -9 |     |     |     |     0 | -437.677184620415 | -437.6771846204150000 |     1 |  -999.00 |  -999.0000000000000000 | -1975 | -1975.0000000000000000 | -1975
  -8 |     -8.0000000000000000 |  -8 |     |     |     |     0 | -436.677184620415 | -436.6771846204150000 |     1 |  -998.00 |  -998.0000000000000000 | -1973 | -1973.0000000000000000 | -1973
  -7 |     -7.0000000000000000 |  -7 |     |     |     |     0 | -435.677184620415 | -435.6771846204150000 |     1 |  -997.00 |  -997.0000000000000000 | -1971 | -1971.0000000000000000 | -1971
  -6 |     -6.0000000000000000 |  -6 |     |     |     |     0 | -434.677184620415 | -434.6771846204150000 |     1 |  -996.00 |  -996.0000000000000000 | -1969 | -1969.0000000000000000 | -1969
  -5 |     -5.0000000000000000 |  -5 |     |     |     |     0 | -433.677184620415 | -433.6771846204150000 |     1 |  -995.00 |  -995.0000000000000000 | -1967 | -1967.0000000000000000 | -1967
  -4 |     -4.0000000000000000 |  -4 |     |     |     |     0 | -432.677184620415 | -432.6771846204150000 |     1 |  -994.00 |  -994.0000000000000000 | -1965 | -1965.0000000000000000 | -1965
  -3 |     -3.0000000000000000 |  -3 |     |     |     |     0 | -431.677184620415 | -431.6771846204150000 |     1 |  -993.00 |  -993.0000000000000000 | -1963 | -1963.0000000000000000 | -1963
  -2 |     -2.0000000000000000 |  -2 |     |     |     |     0 | -430.677184620415 | -430.6771846204150000 |     1 |  -992.00 |  -992.0000000000000000 | -1961 | -1961.0000000000000000 | -1961
(10 rows)

	
select
	min(col_a2),avg(col_a2),sum(col_a2),
	sum(col_a3),max(col_a3),avg(col_a3),count(col_a3),
	max(col_numeric),avg(col_numeric),count(col_numeric),
	sum(col_numeric3),avg(col_numeric3),
	max(col_a4),avg(col_a4),sum(col_a4)
from VECTOR_AGG_TABLE_01 
group by 
	col_a4,
	col_smallint
	order by 12 limit 10;
 min |           avg           | sum | sum | max | avg | count |        max        |          avg          | count |   sum    |          avg           |  max  |          avg           |  sum  
-----+-------------------------+-----+-----+-----+-----+-------+-------------------+-----------------------+-------+----------+------------------------+-------+------------------------+-------
  -1 | -1.00000000000000000000 |  -1 |     |     |     |     0 | -439.677184620415 | -439.6771846204150000 |     1 | -1001.00 | -1001.0000000000000000 | -1979 | -1979.0000000000000000 | -1979
   0 |  0.00000000000000000000 |   0 |     |     |     |     0 | -438.677184620415 | -438.6771846204150000 |     1 | -1000.00 | -1000.0000000000000000 | -1977 | -1977.0000000000000000 | -1977
  -9 |     -9.0000000000000000 |  -9 |     |     |     |     0 | -437.677184620415 | -437.6771846204150000 |     1 |  -999.00 |  -999.0000000000000000 | -1975 | -1975.0000000000000000 | -1975
  -8 |     -8.0000000000000000 |  -8 |     |     |     |     0 | -436.677184620415 | -436.6771846204150000 |     1 |  -998.00 |  -998.0000000000000000 | -1973 | -1973.0000000000000000 | -1973
  -7 |     -7.0000000000000000 |  -7 |     |     |     |     0 | -435.677184620415 | -435.6771846204150000 |     1 |  -997.00 |  -997.0000000000000000 | -1971 | -1971.0000000000000000 | -1971
  -6 |     -6.0000000000000000 |  -6 |     |     |     |     0 | -434.677184620415 | -434.6771846204150000 |     1 |  -996.00 |  -996.0000000000000000 | -1969 | -1969.0000000000000000 | -1969
  -5 |     -5.0000000000000000 |  -5 |     |     |     |     0 | -433.677184620415 | -433.6771846204150000 |     1 |  -995.00 |  -995.0000000000000000 | -1967 | -1967.0000000000000000 | -1967
  -4 |     -4.0000000000000000 |  -4 |     |     |     |     0 | -432.677184620415 | -432.6771846204150000 |     1 |  -994.00 |  -994.0000000000000000 | -1965 | -1965.0000000000000000 | -1965
  -3 |     -3.0000000000000000 |  -3 |     |     |     |     0 | -431.677184620415 | -431.6771846204150000 |     1 |  -993.00 |  -993.0000000000000000 | -1963 | -1963.0000000000000000 | -1963
  -2 |     -2.0000000000000000 |  -2 |     |     |     |     0 | -430.677184620415 | -430.6771846204150000 |     1 |  -992.00 |  -992.0000000000000000 | -1961 | -1961.0000000000000000 | -1961
(10 rows)

	
	
select
	min(col_a2),avg(col_a2),sum(col_a2),
	sum(col_a3),max(col_a3),avg(col_a3),count(col_a3),
	max(col_numeric),avg(col_numeric),count(col_numeric),
	sum(col_numeric3),avg(col_numeric3),
	max(col_a4),avg(col_a4),sum(col_a4)
from VECTOR_AGG_TABLE_01 
group by 
	col_a4,
	col_smallint
	order by 12 limit 10;
 min |           avg           | sum | sum | max | avg | count |        max        |          avg          | count |   sum    |          avg           |  max  |          avg           |  sum  
-----+-------------------------+-----+-----+-----+-----+-------+-------------------+-----------------------+-------+----------+------------------------+-------+------------------------+-------
  -1 | -1.00000000000000000000 |  -1 |     |     |     |     0 | -439.677184620415 | -439.6771846204150000 |     1 | -1001.00 | -1001.0000000000000000 | -1979 | -1979.0000000000000000 | -1979
   0 |  0.00000000000000000000 |   0 |     |     |     |     0 | -438.677184620415 | -438.6771846204150000 |     1 | -1000.00 | -1000.0000000000000000 | -1977 | -1977.0000000000000000 | -1977
  -9 |     -9.0000000000000000 |  -9 |     |     |     |     0 | -437.677184620415 | -437.6771846204150000 |     1 |  -999.00 |  -999.0000000000000000 | -1975 | -1975.0000000000000000 | -1975
  -8 |     -8.0000000000000000 |  -8 |     |     |     |     0 | -436.677184620415 | -436.6771846204150000 |     1 |  -998.00 |  -998.0000000000000000 | -1973 | -1973.0000000000000000 | -1973
  -7 |     -7.0000000000000000 |  -7 |     |     |     |     0 | -435.677184620415 | -435.6771846204150000 |     1 |  -997.00 |  -997.0000000000000000 | -1971 | -1971.0000000000000000 | -1971
  -6 |     -6.0000000000000000 |  -6 |     |     |     |     0 | -434.677184620415 | -434.6771846204150000 |     1 |  -996.00 |  -996.0000000000000000 | -1969 | -1969.0000000000000000 | -1969
  -5 |     -5.0000000000000000 |  -5 |     |     |     |     0 | -433.677184620415 | -433.6771846204150000 |     1 |  -995.00 |  -995.0000000000000000 | -1967 | -1967.0000000000000000 | -1967
  -4 |     -4.0000000000000000 |  -4 |     |     |     |     0 | -432.677184620415 | -432.6771846204150000 |     1 |  -994.00 |  -994.0000000000000000 | -1965 | -1965.0000000000000000 | -1965
  -3 |     -3.0000000000000000 |  -3 |     |     |     |     0 | -431.677184620415 | -431.6771846204150000 |     1 |  -993.00 |  -993.0000000000000000 | -1963 | -1963.0000000000000000 | -1963
  -2 |     -2.0000000000000000 |  -2 |     |     |     |     0 | -430.677184620415 | -430.6771846204150000 |     1 |  -992.00 |  -992.0000000000000000 | -1961 | -1961.0000000000000000 | -1961
(10 rows)

select 
	max(col_a3),avg(col_a3),avg(col_numeric),count(col_numeric)
from VECTOR_AGG_TABLE_01 where col_bigint%37=2  group by col_char having(min(col_char) = any(select col_char from vector_agg_table_02))
 order by 3 limit 10;
 max | avg |          avg          | count 
-----+-----+-----------------------+-------
     |     | -409.6771846204150000 |     1
     |     | -372.6771846204150000 |     1
     |     | -335.6771846204150000 |     1
     |     | -298.6771846204150000 |     1
     |     | -261.6771846204150000 |     1
     |     | -224.6771846204150000 |     1
     |     | -187.6771846204150000 |     1
     |     | -150.6771846204150000 |     1
     |     | -113.6771846204150000 |     1
     |     |  -76.6771846204150000 |     1
(10 rows)

select 	min(col_a2),avg(col_a2),count(col_a2),
	max(col_a3),avg(col_a3),count(col_a3),
	min(col_numeric),avg(col_numeric),count(col_numeric),
	sum(col_numeric3),avg(col_numeric3),count(col_numeric3),
	max(col_integer),avg(col_integer),count(*)
from VECTOR_AGG_TABLE_01 where col_varchar in (select min(col_varchar) from VECTOR_AGG_TABLE_01 group by col_char2 order by 1);
 min |          avg           | count | max | avg | count |       min        |         avg          | count | sum  |          avg           | count | max |          avg           | count 
-----+------------------------+-------+-----+-----+-------+------------------+----------------------+-------+------+------------------------+-------+-----+------------------------+-------
   0 | 0.00000000000000000000 |     1 |     |     |     0 | 561.322815379585 | 561.3228153795850000 |     1 | 0.00 | 0.00000000000000000000 |     1 |   0 | 0.00000000000000000000 |     1
(1 row)

-- mix of join and agg
select 	
	max(col_a3),avg(col_a3),count(col_a3),
	min(col_numeric),avg(col_numeric),count(col_numeric),
	sum(col_numeric3),avg(col_numeric3),count(col_numeric3),
	max(col_integer),avg(col_integer),count(*)
from vector_agg_table_01 A, vector_agg_table_02 B where A.col_bigint = B.col_bint group by A.col_integer, B.col_bint order by 1, 2 limit 30;
 max | avg | count |       min        |         avg          | count | sum  |          avg           | count | max |          avg           | count 
-----+-----+-------+------------------+----------------------+-------+------+------------------------+-------+-----+------------------------+-------
     |     |     0 | 561.322815379585 | 561.3228153795850000 |     2 | 0.00 | 0.00000000000000000000 |     2 |   0 | 0.00000000000000000000 |     2
(1 row)

select 	
	max(col_a3),avg(col_a3),count(col_a3),
	min(col_numeric),avg(col_numeric),count(col_numeric),
	sum(col_numeric3),avg(col_numeric3),count(col_numeric3),
	max(col_integer),avg(col_integer),count(*)
from vector_agg_table_01 A, vector_agg_table_02 B where A.col_bigint = B.col_bint group by A.col_integer + B.col_bint order by 1 limit 30;
 max | avg | count |       min        |         avg          | count | sum  |          avg           | count | max |          avg           | count 
-----+-----+-------+------------------+----------------------+-------+------+------------------------+-------+-----+------------------------+-------
     |     |     0 | 561.322815379585 | 561.3228153795850000 |     2 | 0.00 | 0.00000000000000000000 |     2 |   0 | 0.00000000000000000000 |     2
(1 row)

--test for in disk
set work_mem='64kB';
select
	min(col_a2),avg(col_a2),sum(col_a2),
	sum(col_a3),max(col_a3),avg(col_a3),count(col_a3),
	max(col_numeric),avg(col_numeric),count(col_numeric),
	sum(col_numeric3),avg(col_numeric3),
	max(col_a4),avg(col_a4),sum(col_a4)
from VECTOR_AGG_TABLE_01 
group by 
	col_a4,
	col_smallint
	order by 12 limit 10;
 min |           avg           | sum | sum | max | avg | count |        max        |          avg          | count |   sum    |          avg           |  max  |          avg           |  sum  
-----+-------------------------+-----+-----+-----+-----+-------+-------------------+-----------------------+-------+----------+------------------------+-------+------------------------+-------
  -1 | -1.00000000000000000000 |  -1 |     |     |     |     0 | -439.677184620415 | -439.6771846204150000 |     1 | -1001.00 | -1001.0000000000000000 | -1979 | -1979.0000000000000000 | -1979
   0 |  0.00000000000000000000 |   0 |     |     |     |     0 | -438.677184620415 | -438.6771846204150000 |     1 | -1000.00 | -1000.0000000000000000 | -1977 | -1977.0000000000000000 | -1977
  -9 |     -9.0000000000000000 |  -9 |     |     |     |     0 | -437.677184620415 | -437.6771846204150000 |     1 |  -999.00 |  -999.0000000000000000 | -1975 | -1975.0000000000000000 | -1975
  -8 |     -8.0000000000000000 |  -8 |     |     |     |     0 | -436.677184620415 | -436.6771846204150000 |     1 |  -998.00 |  -998.0000000000000000 | -1973 | -1973.0000000000000000 | -1973
  -7 |     -7.0000000000000000 |  -7 |     |     |     |     0 | -435.677184620415 | -435.6771846204150000 |     1 |  -997.00 |  -997.0000000000000000 | -1971 | -1971.0000000000000000 | -1971
  -6 |     -6.0000000000000000 |  -6 |     |     |     |     0 | -434.677184620415 | -434.6771846204150000 |     1 |  -996.00 |  -996.0000000000000000 | -1969 | -1969.0000000000000000 | -1969
  -5 |     -5.0000000000000000 |  -5 |     |     |     |     0 | -433.677184620415 | -433.6771846204150000 |     1 |  -995.00 |  -995.0000000000000000 | -1967 | -1967.0000000000000000 | -1967
  -4 |     -4.0000000000000000 |  -4 |     |     |     |     0 | -432.677184620415 | -432.6771846204150000 |     1 |  -994.00 |  -994.0000000000000000 | -1965 | -1965.0000000000000000 | -1965
  -3 |     -3.0000000000000000 |  -3 |     |     |     |     0 | -431.677184620415 | -431.6771846204150000 |     1 |  -993.00 |  -993.0000000000000000 | -1963 | -1963.0000000000000000 | -1963
  -2 |     -2.0000000000000000 |  -2 |     |     |     |     0 | -430.677184620415 | -430.6771846204150000 |     1 |  -992.00 |  -992.0000000000000000 | -1961 | -1961.0000000000000000 | -1961
(10 rows)

select 
	max(col_a3),avg(col_a3),avg(col_numeric),count(col_numeric)
from VECTOR_AGG_TABLE_01 where col_bigint%37=2  group by col_char having(min(col_char) = any(select col_char from vector_agg_table_02))
 order by 3 limit 10;
 max | avg |          avg          | count 
-----+-----+-----------------------+-------
     |     | -409.6771846204150000 |     1
     |     | -372.6771846204150000 |     1
     |     | -335.6771846204150000 |     1
     |     | -298.6771846204150000 |     1
     |     | -261.6771846204150000 |     1
     |     | -224.6771846204150000 |     1
     |     | -187.6771846204150000 |     1
     |     | -150.6771846204150000 |     1
     |     | -113.6771846204150000 |     1
     |     |  -76.6771846204150000 |     1
(10 rows)

