--Export unsupport
---

CREATE foreign TABLE EXPORT_LINEITEM
(
    L_ORDERKEY    BIGINT NOT NULL
  , L_PARTKEY     BIGINT NOT NULL
  , L_SUPPKEY     BIGINT NOT NULL
  , L_LINENUMBER  BIGINT NOT NULL
  , L_QUANTITY    DECIMAL(15,2) NOT NULL
  , L_EXTENDEDPRICE  DECIMAL(15,2) NOT NULL
  , L_DISCOUNT    DECIMAL(15,2) NOT NULL
  , L_TAX         DECIMAL(15,2) NOT NULL
  , L_RETURNFLAG  CHAR(1) NOT NULL
  , L_LINESTATUS  CHAR(1) NOT NULL
  , L_SHIPDATE    DATE NOT NULL
  , L_COMMITDATE  DATE NOT NULL
  , L_RECEIPTDATE DATE NOT NULL
  , L_SHIPINSTRUCT CHAR(25) NOT NULL
  , L_SHIPMODE     CHAR(10) NOT NULL
  , L_COMMENT      VARCHAR(44) NOT NULL
)
server gsmpp_server
options(location '@abs_srcdir@/results/' , delimiter '|') write only;

CREATE FOREIGN TABLE EXPORT1(c1 int) server gsmpp_server options(location '@abs_srcdir@/results', delimiter '|') write only;
CREATE FOREIGN TABLE EXPORT2(c1 int) server gsmpp_server options(location '@abs_srcdir@/data/export_test.dat', delimiter '|', mode 'shared');
DROP TABLE IF EXISTS LINEITEM;
CREATE TABLE LINEITEM
(
    L_ORDERKEY    BIGINT NOT NULL
  , L_PARTKEY        BIGINT
  , L_SUPPKEY     BIGINT NOT NULL
  , L_LINENUMBER  BIGINT NOT NULL
  , L_QUANTITY    DECIMAL(15,2) NOT NULL
  , L_EXTENDEDPRICE  DECIMAL(15,2) NOT NULL
  , L_DISCOUNT    DECIMAL(15,2) NOT NULL
  , L_TAX         DECIMAL(15,2) NOT NULL
  , L_RETURNFLAG  CHAR(1) NOT NULL
  , L_LINESTATUS  CHAR(1) NOT NULL
  , L_SHIPDATE    DATE NOT NULL
  , L_COMMITDATE  DATE NOT NULL
  , L_RECEIPTDATE DATE NOT NULL
  , L_SHIPINSTRUCT CHAR(25) NOT NULL
  , L_SHIPMODE     CHAR(10) NOT NULL
  , L_COMMENT      VARCHAR(44) NOT NULL
  , CHECK (L_PARTKEY > 10)
)
distribute by hash(L_ORDERKEY);

EXPLAIN INSERT INTO EXPORT_LINEITEM SELECT * FROM LINEITEM LIMIT 10;

EXPLAIN INSERT INTO EXPORT_LINEITEM SELECT * FROM LINEITEM OFFSET 10;

EXPLAIN INSERT INTO EXPORT_LINEITEM SELECT * FROM LINEITEM ORDER BY L_ORDERKEY;

EXPLAIN INSERT INTO EXPORT1 SELECT count(*) FROM LINEITEM;

EXPLAIN INSERT INTO EXPORT1 SELECT RANK() OVER(PARTITION BY L_ORDERKEY ORDER BY L_ORDERKEY) FROM LINEITEM;

EXPLAIN INSERT INTO EXPORT1 SELECT DISTINCT L_ORDERKEY FROM LINEITEM;

EXPLAIN INSERT INTO EXPORT_LINEITEM SELECT * FROM LINEITEM UNION SELECT * FROM LINEITEM;

EXPLAIN INSERT INTO EXPORT1 SELECT 1+2;

EXPLAIN INSERT INTO EXPORT1 VALUES(5),(6);

EXPLAIN INSERT INTO EXPORT1 SELECT * FROM EXPORT2;

EXPLAIN INSERT INTO EXPORT1 SELECT L_ORDERKEY FROM LINEITEM GROUP BY L_ORDERKEY;

EXPLAIN (costs off) INSERT INTO EXPORT_LINEITEM SELECT * FROM LINEITEM WHERE L_ORDERKEY > 1000;

EXPLAIN INSERT INTO EXPORT_LINEITEM SELECT (SELECT AVG(L_ORDERKEY) FROM LINEITEM) FROM LINEITEM WHERE L_ORDERKEY > 1000;

EXPLAIN INSERT INTO EXPORT_LINEITEM SELECT * FROM LINEITEM WHERE L_ORDERKEY > (SELECT L_PARTKEY FROM LINEITEM);

EXPLAIN INSERT INTO EXPORT_LINEITEM SELECT * FROM LINEITEM WHERE L_ORDERKEY > (SELECT AVG(L_ORDERKEY) FROM LINEITEM L2 WHERE L2.L_PARTKEY=LINEITEM.L_PARTKEY);

EXPLAIN INSERT INTO EXPORT_LINEITEM VALUES(1, 100, 1, 1, 1, 1, 1, 1, '1', '1', '2014-09-18', '2014-09-18', '2014-09-18', 'hello world', 'lover', 'kaka');

EXPLAIN WITH TMP AS (SELECT * FROM LINEITEM LIMIT 10) INSERT INTO EXPORT_LINEITEM SELECT * FROM TMP;

DROP TABLE LINEITEM;
DROP FOREIGN TABLE EXPORT_LINEITEM;
DROP FOREIGN TABLE EXPORT1;
DROP FOREIGN TABLE EXPORT2;

-- unsupport location
DROP FOREIGN TABLE IF EXISTS hw_export_invalid_location;
CREATE FOREIGN TABLE hw_export_invalid_location
(
C_CHAR_3 CHAR(16),
C_VARCHAR_3 VARCHAR(1024),
C_INT INTEGER,
C_NUMERIC numeric(10,5),
C_TS_WITHOUT TIMESTAMP WITHOUT TIME ZONE
)
SERVER Gsmpp_server
Options(Location '@abs_srcdir@/data/parallel_export/|/|///',
Format 'Text')
Write Only;
